"use strict";(self.webpackChunkfl_assistant=self.webpackChunkfl_assistant||[]).push([[999],{8692:(e,t,r)=>{r.r(t),r.d(t,{default:()=>G});var a={};r.r(a),r.d(a,{getActions:()=>x});var n={};r.r(n),r.d(n,{getActions:()=>P});var i={};r.r(i),r.d(i,{getActions:()=>U});var l={};r.r(l),r.d(l,{getActions:()=>T});var s={};r.r(s),r.d(s,{getActions:()=>A});var o={};r.r(o),r.d(o,{document:()=>l,image:()=>n,post:()=>a,svg:()=>i,theme_settings:()=>s});var c=r(7363),u=r.n(c),m=r(6711),d=r(2411),p=r(9818),b=r(8003),h=r(2974),y=r(4533);const g=()=>{const e=(0,m.useHistory)(),{cloudUser:t}=(0,p.useSystemState)(),{pathname:r}=(0,m.useLocation)(),{isReadOnly:a,library:n,showUpload:i,setShowUpload:l}=h.Libraries.LibraryContext.use(),s=`/libraries/${n.id}`,o=t.id===n.permissions.permissions_user_id;if(!(n.permissions.update||n.permissions.edit_items||n.permissions.shared||o))return null;return u().createElement(u().Fragment,null,!a&&n.permissions.edit_items&&u().createElement(y.Button,{appearance:"transparent",isSelected:i&&!r.includes("/settings"),onClick:()=>{l(!i),r!==s&&e.goBack()},style:{marginLeft:"auto"}},u().createElement(y.Icon.Plus,null)),(n.permissions.update||n.permissions.shared||o)&&u().createElement(y.Button,{appearance:"transparent",isSelected:r.includes("/settings"),onClick:()=>{r===s&&e.push(`${s}/settings`)}},u().createElement(y.Icon.Cog,null)))};var _=r(7462),E=r(3895),f=r.n(E);const L=()=>{const{isReadOnly:e,library:t,showUpload:r,uploader:a}=h.Libraries.LibraryContext.use();return e||!t.permissions.edit_items?null:u().createElement(u().Fragment,null,r&&u().createElement(h.Libraries.LibraryUpload,null),!!a.queuedFiles.length&&u().createElement(y.Layout.Box,{padY:!1},u().createElement(h.Uploader.FileList,{files:a.queuedFiles})))},v=()=>{const{library:e}=h.Libraries.LibraryContext.use();return u().createElement(u().Fragment,null,u().createElement(y.Layout.Box,{style:{textAlign:"center",padding:0}},u().createElement(y.Layout.Headline,{style:{margin:10}},e.name),e.description&&u().createElement("div",{style:{marginTop:"var(--fluid-sm-space)"}},e.description)),u().createElement(h.Libraries.LibraryMemberThumbs,null))},C=e=>{const{useItemsFilter:t}=(0,p.getAppHooks)("libraries"),[r,a]=t(),{defaultItemsFilter:n}=(0,p.useAppState)("libraries",["defaultItemsFilter"]),i=()=>"type"===r.viewBy?u().createElement(y.Filter.RadioGroupItem,{title:(0,b.__)("Type"),items:h.Libraries.getItemTypeOptions(),value:r.type,defaultValue:n.type,onChange:e=>a({...r,type:e})}):u().createElement(y.Filter.RadioGroupItem,{title:(0,b.__)("Collection"),items:h.Libraries.getCollectionOptions(),value:r.collection,defaultValue:n.collection,onChange:e=>a({...r,collection:e})});return u().createElement(y.Filter,e,u().createElement(y.Filter.RadioGroupItem,{title:(0,b.__)("View By"),items:{type:(0,b.__)("Type"),collection:(0,b.__)("Collection")},value:r.viewBy,defaultValue:n.viewBy,onChange:e=>a({...r,viewBy:e})}),u().createElement(i,null),u().createElement(y.Filter.RadioGroupItem,{title:(0,b.__)("Sort By"),items:{name:(0,b.__)("Title"),created_at:(0,b.__)("Date Created"),updated_at:(0,b.__)("Last Updated")},value:r.orderBy,defaultValue:n.orderBy,onChange:e=>a({...r,orderBy:e})}),u().createElement(y.Filter.RadioGroupItem,{title:(0,b.__)("Order"),items:{ASC:(0,b.__)("Ascending"),DESC:(0,b.__)("Descending")},value:r.order,defaultValue:n.order,onChange:e=>a({...r,order:e})}),u().createElement(y.Filter.Button,{onClick:()=>a(n)},(0,b.__)("Reset Filter")))},w=e=>{let{children:t,...r}=e;const{isReadOnly:a,library:n,uploader:i}=h.Libraries.LibraryContext.use();return!a&&n.permissions.edit_items?u().createElement(y.Layout.DropArea,(0,_.Z)({onDrop:i.handleDrop},r),t):u().createElement("div",r,t)},S=()=>{const e=(0,m.useLocation)(),{items:t,showUpload:r,library:a}=h.Libraries.LibraryContext.use(),{defaultItemsFilter:n}=(0,p.useAppState)("libraries","defaultItemsFilter"),{useItemsFilter:i}=(0,p.getAppHooks)("libraries"),[l,s]=i(),o=h.Libraries.getFilteredItems(l,t),c=t&&!!t.length,{isSelecting:g,items:_,clearSelection:E,totalSelectedItems:S}=d.Selection.use(),I=a.permissions.edit_items&&!function(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).some((t=>e.endsWith(t)))}(e.pathname,["/share","/settings","/collections"]),k=()=>{const{setItems:e}=h.Libraries.LibraryContext.use();return u().createElement(y.Button,{status:"destructive",icon:u().createElement(y.Icon.Trash,null),disabled:0>=S,onClick:()=>{confirm((0,b.__)("Do you really want to delete these items?"))&&async function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];f().libraries.deleteItem(r).finally((()=>{e([...t.filter((e=>!_.includes(e.id)))]),E()}))}(_)}},(0,b.__)("Delete"))};return u().createElement(w,{className:"fl-asst-library-content"},u().createElement(C,{style:{visibility:g&&"hidden"}}),g&&u().createElement(d.Selection.Toolbar,{style:{minHeight:48,flexBasis:48,position:"absolute",top:0,width:"100%"}},u().createElement(k,null)),u().createElement(d.Selection.Box,{itemSelector:".fluid-collection-item",mapElementToData:e=>parseInt(e.dataset.selectionId),isEnabled:I},u().createElement(v,null),u().createElement(L,null),u().createElement(h.Libraries.ItemsList,null),(()=>{const{viewBy:e,type:r,collection:a}=l;if(t&&!Object.keys(o).length){if("type"===e&&"all"!==r)return!0;if("collection"===e&&"all"!==a)return!0}return!1})()&&!r&&u().createElement(u().Fragment,null,u().createElement(y.Layout.Box,{style:{textAlign:"center"}},(0,b.__)("No results found.")),u().createElement(y.Layout.Row,null,u().createElement(y.Button,{onClick:()=>s(n)},(0,b.__)("Reset Filter")))),t&&!c&&!r&&u().createElement(y.Layout.Box,{style:{textAlign:"center"}},(0,b.__)("This library doesn't have any items yet."))))};var I=r(1871);const k=()=>{const e=(0,I.getWpRest)().libraries(),t=(0,c.useRef)(0),r=(t,r,n)=>{e.importPostThumb(t.id,r.media.thumb).finally((()=>{a(t,r,n)}))},a=(r,n,i)=>{const{attachments:l}=n.media;if(void 0===l)return void i(r);const s=l[t.current];void 0===s?(t.current=0,i(r)):e.importPostMedia(r.id,s).finally((()=>{t.current++,a(r,n,i)}))};return(e,t)=>new Promise((n=>{t.media.thumb?r(e,t,n):a(e,t,n)}))},x=(e,t)=>{const{library:r}=h.Libraries.LibraryContext.use();return t.unshift({component:u().createElement(F,{item:e})}),t.unshift({component:u().createElement(B,{item:e}),shouldRender:r.permissions.edit_items}),t.unshift({component:u().createElement(D,{item:e})}),t},F=e=>{let{item:t}=e;const{createNotice:r}=h.Libraries.ItemContext.use(),[a,n]=(0,c.useState)(!1),i=(0,I.getWpRest)().libraries(),l=e=>{!e||e.data.error?r({status:"error",content:(0,b.__)("Error previewing content.")}):window.open(e.data.url)};return u().createElement(y.Button,{onClick:()=>{n(!0),i.previewPost(t).then((e=>{l(e)})).catch((()=>{l()})).finally((()=>{n(!1)}))},disabled:a},(0,b.__)("Preview"))},B=e=>{let{item:t}=e;const{currentPageView:r,isLocalhost:a}=(0,p.getSystemConfig)(),{id:n,type:i,isSingular:l}=r,[s,o]=(0,c.useState)(!1),{updateItems:m}=h.Libraries.LibraryContext.use(),{createNotice:d,setItem:g}=h.Libraries.ItemContext.use(),{updateFormValues:_}=h.Libraries.ItemFormContext.use(),E=(0,I.getWpRest)().libraries(),f=(0,I.getWpRest)().posts(),L=[{label:(0,b.__)("Cancel"),disabled:s,onClick:e=>{let{closeDialog:t}=e;return t()}}];l&&L.push({label:s?(0,b.__)("Updating..."):(0,b.__)("Update"),isSelected:!0,disabled:s,onClick:e=>{let{closeDialog:r}=e;const a=(0,b.sprintf)((0,b.__)("Do you really want to update this library item and replace its content with the current %s? This cannot be undone."),i.toLowerCase());if(!confirm(a))return;o(!0);f.findById(n).then((e=>{let{data:a}=e;h.Uploader.screenshotUrl(a.previewUrl).then((e=>{!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";E.syncLibraryPost(n,t,{screenshot:e}).then((e=>{g(e.data),m(e.data),_(e.data),d({status:"success",content:(0,b.__)("Library item updated!"),shouldDismiss:!1})})).catch((()=>{d({status:"error",content:(0,b.__)("Error updating library item."),shouldDismiss:!1})})).finally((()=>{o(!1),r()}))}(e)}))}))}});const[v,C]=y.Modal.useDialog({title:(0,b.__)("Update this Library Item"),message:u().createElement(R,null),buttons:L});return u().createElement(u().Fragment,null,u().createElement(y.Button,{onClick:v},(0,b.__)("Update")),u().createElement(C,null))},R=()=>{const{currentPageView:e}=(0,p.getSystemConfig)(),{intro:t,name:r,type:a,isSingular:n}=e;return n?u().createElement(u().Fragment,null,u().createElement("div",{style:{padding:"var(--fluid-med-space) 0"}},u().createElement("strong",null,t,":")," ",r),u().createElement("div",null,(0,b.sprintf)((0,b.__)("Updating this library item will replace its content with the content of the current %s."),a.toLowerCase()))):(0,b.__)("Updating is currently not available. To update this library item, navigate to the post or page you'd like to update it with and click the update button again.")},D=e=>{let{item:t}=e;const{currentPageView:r,contentTypes:a}=(0,p.getSystemConfig)(),{createNotice:n}=h.Libraries.ItemContext.use(),[i,l]=(0,c.useState)(null),[s,o]=(0,c.useState)(!1),m=(0,I.getWpRest)().libraries(),d=k(),y=e=>{const{editUrl:t,type:r}=e,i=a[r]?a[r].labels.singular:(0,b.__)("Content");l(null),o(!1),e.error?n({status:"error",shouldDismiss:!1,content:(0,b.__)("Error importing library item.")}):n({status:"success",shouldDismiss:!1,content:u().createElement(u().Fragment,null,(0,b.__)("Library item imported!"),t&&u().createElement("a",{style:{textDecoration:"underline",marginLeft:"var(--fluid-sm-space)"},onClick:()=>{window.location.href=t}},(0,b.sprintf)((0,b.__)("Edit %s."),i)))})},g=e=>{l(null),o(!1),!e||e.error?n({status:"error",shouldDismiss:!1,content:(0,b.sprintf)((0,b.__)("Error replacing %s."),r.type.toLowerCase())}):(n({status:"success",shouldDismiss:!1,content:(0,b.sprintf)((0,b.__)("%s replaced!"),r.type)}),window.location.reload())};return(0,c.useEffect)((()=>{"create"===i?m.importPost(t).then((e=>{o(!0),d(e.data,t).then(y)})).catch((()=>{l(null),o(!1),n({status:"error",content:(0,b.__)("Error importing library item.")})})):"replace"===i&&(()=>{if(!r.isSingular)return alert((0,b.__)("Replacing is currently not available. Navigate to the post or page you'd like to replace and click the import button again.")),void l(null);const e=(0,b.sprintf)((0,b.__)("Do you really want to replace the current %s with this library item? This cannot be undone."),r.type.toLowerCase());confirm(e)?m.syncPost(r.id,t).then((e=>{o(!0),d(e.data,t).then((()=>{g(e.data)}))})).catch((()=>{g()})):l(null)})()}),[i]),u().createElement(u().Fragment,null,u().createElement("select",{value:"",onChange:e=>l(e.target.value),disabled:i},u().createElement("option",{value:""},!s&&!i&&(0,b.__)("Import..."),!s&&i&&(0,b.__)("Importing..."),s&&(0,b.__)("Importing media...")),u().createElement("option",{value:"create"},(0,b.__)("Create New")),u().createElement("option",{value:"replace"},r.isSingular?(0,b.sprintf)((0,b.__)("Replace Current %s"),r.type):(0,b.__)("Replace Current Page"))))},P=(e,t)=>{const{createNotice:r}=h.Libraries.ItemContext.use(),[a,n]=(0,c.useState)(!1),i=(0,I.getWpRest)();return t.unshift({label:(0,b.__)("Import"),onClick:()=>{n(!0),i.libraries().importItem(e).then((e=>{r({status:e.data.error?"error":"success",content:e.data.error?e.data.error:(0,b.__)("Item imported!")})})).catch((e=>{r({status:"error",content:e.response.data.message})})).finally((()=>{n(!1)}))},disabled:a}),t},U=(e,t)=>{const{createNotice:r}=h.Libraries.ItemContext.use(),[a,n]=(0,c.useState)(!1),i=(0,I.getWpRest)();return t.unshift({label:(0,b.__)("Import"),onClick:()=>{n(!0),i.libraries().importItem(e).then((e=>{r({status:e.data.error?"error":"success",content:e.data.error?e.data.error:(0,b.__)("Item imported!")})})).catch((e=>{r({status:"error",content:e.response.data.message})})).finally((()=>{n(!1)}))},disabled:a}),t},T=(e,t)=>{const{createNotice:r}=h.Libraries.ItemContext.use(),[a,n]=(0,c.useState)(!1),i=(0,I.getWpRest)();return t.unshift({label:(0,b.__)("Import"),onClick:()=>{n(!0),i.libraries().importItem(e).then((e=>{r({status:e.data.error?"error":"success",content:e.data.error?e.data.error:(0,b.__)("Item imported!")})})).catch((e=>{r({status:"error",content:e.response.data.message})})).finally((()=>{n(!1)}))},disabled:a}),t},A=(e,t)=>{const{adminURLs:r,themeSlug:a,themeParentSlug:n}=(0,p.getSystemConfig)(),{createNotice:i}=h.Libraries.ItemContext.use(),[l,s]=(0,c.useState)(!1),o=(0,I.getWpRest)().libraries(),u=()=>{const{name:t,slug:r,parent:i}=e.data.theme;return(!i||i.slug!==a&&i.slug!==n)&&(r!==a&&r!==n&&(i?alert((0,b.sprintf)((0,b.__)('The themes "%s" or "%s" must be active to apply or preview these settings.'),i.name,t)):alert((0,b.sprintf)((0,b.__)('The theme "%s" must be active to apply or preview these settings.'),t)),!0))};return t.unshift({label:(0,b.__)("Apply to Theme"),onClick:()=>{u()||confirm((0,b.__)("Do you really want to import these theme settings? This will update your site design and cannot be undone."))&&(s(!0),o.importThemeSettings(e.id).then((e=>{s(!1),e.data.data.error?i({status:"error",content:e.data.data.error,shouldDismiss:!1}):(i({status:"success",content:(0,b.__)("Settings imported!")}),window.location.reload())})))},disabled:l}),t.unshift({label:(0,b.__)("Preview"),onClick:()=>{u()||window.open(`${r.customizeBase}?fl-asst-customizer-preview-init=${e.id}`)}}),t},N=()=>u().createElement("div",{style:{display:"flex",position:"absolute",top:0,right:0,bottom:0,left:0,width:"100%"}},u().createElement(h.Libraries.ItemDetail,{formConfig:o})),O=()=>{const{items:e}=h.Libraries.LibraryContext.use(),[t,r]=(0,c.useState)(null),[a,n]=(0,c.useState)(!1),i=k();(0,c.useEffect)((()=>{null!==t&&l()}),[t]);const l=()=>{const r=e[t],a=(0,I.getWpRest)().libraries();"color"===r.type||"theme_settings"===r.type?s():"post"===r.type?f().libraries.getItem(r.id).then((e=>{a.importPost(e.data).then((t=>{i(t.data,e.data).then((()=>{s()}))})).catch((()=>{s()}))})).catch((()=>{s()})):a.importItem(r).finally(s)},s=()=>{const a=null===t?0:t+1;if(!e[a])return r(null),void n(!0);r(a)};return null!==t||a?u().createElement(u().Fragment,null,u().createElement("p",null,(0,b.__)("Import in progress. Navigating away from this view will stop the import process!")),u().createElement(V,{progress:null===t?100:t/e.length*100}),u().createElement("p",{style:{fontStyle:"italic",fontSize:"12px",marginTop:"var(--fluid-sm-space)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},null!==t&&(0,b.sprintf)((0,b.__)("Importing %s"),e[t].name),null===t&&(0,b.__)("Import Complete!"))):u().createElement(W,{onClick:()=>s()})},W=e=>{let{onClick:t}=e;return u().createElement(u().Fragment,null,u().createElement("p",null,(0,b.__)("Click the button below to import all items in this library into your site.")),u().createElement(y.Button,{onClick:t},(0,b.__)("Import Library")))},V=e=>{let{progress:t}=e;return u().createElement("div",{style:{background:"var(--fluid-transparent-10)",borderRadius:"var(--fluid-radius)",height:"6px"}},u().createElement("div",{style:{background:"var(--fluid-transparent-4)",borderRadius:"var(--fluid-radius)",height:"6px",width:`${t}%`}}))},H=()=>{const{isReadOnly:e,library:t}=h.Libraries.LibraryContext.use(),{cloudUser:r}=(0,p.useSystemState)(),a=r.id===t.permissions.permissions_user_id&&!t.permissions.owner,n=t.permissions.shared&&!t.permissions.owner||a;return u().createElement(u().Fragment,null,!n&&u().createElement(y.Layout.Box,{padY:!1,className:"fl-asst-library-settings"},u().createElement(y.Page.Section,{label:(0,b.__)("Library Settings"),padY:!1},u().createElement(h.Libraries.LibrarySettingsForm,null))),!e&&u().createElement(u().Fragment,null,!n&&u().createElement(y.Layout.Box,{padY:!1},u().createElement(y.Page.Section,{label:(0,b.__)("Library Collections")},u().createElement(h.Libraries.LibraryCollectionsForm,null))),n&&t.permissions.edit_collections&&u().createElement(y.Layout.Box,{padY:!1},u().createElement(y.Page.Section,{label:(0,b.__)("Library Collections")},u().createElement(h.Libraries.LibraryCollectionsForm,null))),u().createElement(y.Layout.Box,{padY:!1},u().createElement(y.Page.Section,{label:(0,b.__)("Import Library")},u().createElement(O,null)))),t.permissions.delete&&u().createElement(y.Layout.Box,null,u().createElement(y.Page.Section,{label:(0,b.__)("Danger Zone")},u().createElement(y.Layout.Headline,null,(0,b.__)("Delete This Library")),u().createElement("p",{style:{margin:"0"}},(0,b.__)("Once a library has been deleted, it is gone forever. Please be sure you want to delete this library."))),u().createElement(h.Libraries.LibraryDeleteForm,null)))},Y=()=>{const{pathname:e}=(0,m.useLocation)();return u().createElement(h.Libraries.LibraryDetail,null,u().createElement("div",{style:{visibility:e.includes("/items/")?"hidden":"",width:"100%",flex:"1 1 auto",display:"flex",position:"absolute",top:0,bottom:0}},u().createElement(y.Page,{title:(0,b.__)("Library"),shouldShowBackButton:!0,actions:u().createElement(g,null),padX:!1,padY:!1},u().createElement(m.Switch,null,u().createElement(m.Route,{path:"/libraries/:id/settings",component:H}),u().createElement(m.Route,{path:"/libraries/:id",component:S})))),u().createElement(m.Switch,null,u().createElement(m.Route,{path:"/libraries/:id/item/:itemId",component:N})))},$=()=>{const{cloudConfig:e}=(0,p.getSystemConfig)(),{cloudUser:t}=(0,p.useSystemState)(),[r,a]=(0,c.useState)(!1),n=()=>u().createElement(u().Fragment,null,u().createElement(y.Menu.Item,{href:e.appUrl,target:"_blank"},(0,b.__)("Launch Cloud")),u().createElement(y.Menu.Item,{onClick:()=>f().auth.logout()},(0,b.__)("Disconnect")));return u().createElement(y.Menu,{content:u().createElement(n,null),isShowing:r,onOutsideClick:()=>a(!1),style:{zIndex:9}},u().createElement(y.Button,{onClick:()=>a(!r),className:"fl-asst-cloud-gravatar-link",appearance:"elevator",size:"sm",style:{backgroundImage:`url(${t.gravatar.sm})`,backgroundSize:"contain",height:"25px",width:"25px",minHeight:"0",minWidth:"0"}}))},z=(e,t,r)=>{const a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"user",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=t?r[e][t]:r[e];return a?a.map(h.formatItem):[]},n=a("access");return[{key:"user",label:e?e.name:"",avatar:e.avatar?e.avatar.sizes.thumb.url:e.gravatar.md,to:"/libraries/user",items:a(),canCreateLibraries:!0},{key:"shared",label:(0,b.__)("Shared Libraries"),avatar:u().createElement(y.Icon.Shared,null),to:"/libraries/shared",isEnabled:!!r.shared.length,items:a("shared"),canCreateLibraries:!1},{key:"community",label:(0,b.__)("Community Libraries"),avatar:u().createElement(y.Icon.Swirl,null),isEnabled:!!n.length,items:n,canCreateLibraries:!1},...function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((e=>({...(0,h.formatSection)(e),items:a("team",e.id),canCreateLibraries:e.permissions.edit_libraries})))}(t)]},M=()=>{const{cloudUser:e}=(0,p.useSystemState)(),{filter:t,libraries:r,teams:a}=(0,p.useAppState)("libraries"),{owner:n,...i}=t;return u().createElement(y.Page,{title:(0,b.__)("Libraries"),icon:u().createElement(y.Icon.Library,{context:"sidebar"}),shouldShowBackButton:!1,actions:u().createElement($,null),padX:!1,padY:!1},u().createElement(h.LibraryNav,{sections:z(e,a,r),isLoading:!1,linkSectionHeaders:!1,displayItemsAs:"grid"}))},G=e=>{let{baseURL:t}=e;const r=(0,m.useHistory)(),{isCloudConnected:a}=(0,p.useSystemState)("isCloudConnected");return a?u().createElement(d.Selection.Provider,null,u().createElement(m.Switch,null,u().createElement(m.Route,{exact:!0,path:`${t}`,component:M}),u().createElement(m.Route,{path:`${t}/:id`,component:Y}))):(r.replace("/fl-cloud-connect"),null)}},7462:(e,t,r)=>{function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},a.apply(this,arguments)}r.d(t,{Z:()=>a})}}]);